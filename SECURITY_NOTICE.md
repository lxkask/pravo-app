# üö® CRITICAL SECURITY NOTICE

**Date**: 2025-12-14
**Severity**: CRITICAL
**Status**: ‚ö†Ô∏è IMMEDIATE ACTION REQUIRED

## Issue Summary

**Exposed credentials found in `.env` and `.env.local` files that may have been committed to git history.**

The following sensitive credentials were discovered:
- ‚úÖ Prisma/PostgreSQL database credentials
- ‚úÖ Prisma Accelerate API key (JWT token)
- ‚úÖ Anthropic API key
- ‚úÖ Vercel OIDC tokens (2x)

## Immediate Action Required

### 1. Rotate Database Credentials

**Platform**: Prisma/PostgreSQL
**Current exposed**:
- Username: `36ef9a17314f31c886525043231eb9762417cf4a25b9ff77427999a9d895d93e`
- Password: `sk_3S0vs6W8oEDMqOXLkQcEB`
- Host: `db.prisma.io:5432`

**Action**:
1. Go to https://console.prisma.io
2. Navigate to your database settings
3. Reset/regenerate database password
4. Update `.env` and `.env.local` with new credentials
5. Redeploy application

### 2. Rotate Anthropic API Key

**Platform**: Anthropic Claude API
**Current exposed**: `sk-ant-api03-[REDACTED]` (full key found in leaked .env files)

**Action**:
1. Go to https://console.anthropic.com/settings/keys
2. **Revoke** the exposed API key immediately
3. Generate a new API key
4. Update `.env` and `.env.local` with new key
5. Test AI features to ensure they work with new key

### 3. Rotate Vercel OIDC Tokens

**Platform**: Vercel
**Current exposed**: 2x JWT tokens in `VERCEL_OIDC_TOKEN`

**Action**:
1. These tokens are automatically generated by Vercel CLI
2. Run `vercel env pull` to get fresh tokens
3. Or they will auto-regenerate on next deployment
4. Monitor Vercel dashboard for any suspicious activity

### 4. Rotate Prisma Accelerate API Key

**Platform**: Prisma Accelerate
**Current exposed**: JWT token in `PRISMA_DATABASE_URL`

**Action**:
1. Go to https://console.prisma.io
2. Navigate to Accelerate settings
3. Regenerate API key
4. Update connection string in `.env` and `.env.local`

## Git History Cleanup (CRITICAL)

‚ö†Ô∏è **WARNING**: If `.env` files were ever committed to git, the credentials are in git history forever until cleaned.

### Option 1: Use BFG Repo-Cleaner (Recommended)

```bash
# Download BFG from https://rtyley.github.io/bfg-repo-cleaner/

# Clone a fresh copy (mirror)
git clone --mirror C:\Users\lukol\Downloads\pravo-app\pravo-quiz-app pravo-quiz-app-clean.git

# Remove .env files from history
java -jar bfg.jar --delete-files ".env*" --no-blob-protection pravo-quiz-app-clean.git

# Clean up
cd pravo-quiz-app-clean.git
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# Push cleaned history (force push)
git push --force
```

### Option 2: Use git-filter-repo

```bash
# Install git-filter-repo
# https://github.com/newren/git-filter-repo

# Remove .env files from entire history
git filter-repo --path .env --path .env.local --path .env.production --path .env.production.local --invert-paths

# Force push
git push origin --force --all
```

### Option 3: Start Fresh Repository (Easiest)

If the repository is not yet pushed to GitHub/GitLab:

1. Delete `.git` folder
2. Initialize new repo: `git init`
3. Add `.gitignore` (already configured)
4. Commit fresh start: `git add . && git commit -m "Initial commit"`

## Verification Checklist

After rotating credentials:

- [ ] Prisma database password changed
- [ ] Prisma Accelerate API key regenerated
- [ ] Anthropic API key revoked and new one generated
- [ ] All `.env*` files updated with new credentials
- [ ] Application tested with new credentials
- [ ] Git history cleaned (if applicable)
- [ ] New commit with updated `.env.example`
- [ ] Vercel environment variables updated (if using Vercel)
- [ ] No errors in production deployment

## Monitoring

After rotation, monitor for:

1. **Prisma Dashboard**: Check for unauthorized database access
2. **Anthropic Console**: Monitor API usage for anomalies
3. **Vercel Dashboard**: Check deployment logs for errors
4. **Application Logs**: Ensure no authentication failures

## Prevention

‚úÖ `.gitignore` already configured correctly:
```gitignore
.env*
!.env.example
```

‚úÖ `.env.example` updated with placeholder values

## Questions?

If you encounter issues:
1. Check Prisma docs: https://www.prisma.io/docs/
2. Check Anthropic docs: https://docs.anthropic.com/
3. Check Vercel docs: https://vercel.com/docs

## Status

- [x] `.env.example` updated
- [x] Security notice created
- [ ] **USER ACTION REQUIRED**: Rotate all credentials
- [ ] **USER ACTION REQUIRED**: Clean git history
- [ ] **USER ACTION REQUIRED**: Test application
- [ ] **USER ACTION REQUIRED**: Update production deployment

---

**Next Steps**: After completing credential rotation, proceed to CRITICAL #2 (Zod validation for LocalStorage).
